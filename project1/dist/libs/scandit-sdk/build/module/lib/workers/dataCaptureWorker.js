export function dataCapture(){const e="/scandit_sync_folder_preload";const t="/scandit_sync_folder";const r="resources";const n=[];const a=[];const s=typeof self.OffscreenCanvas==="function";let o;let i;let l;let c;let u;let f;let d;let g;let h;let m;let p;let y;let b;let S;let _=false;let M=false;let v=false;let T=false;let w=false;let k=false;let F=false;let U=false;let C=false;let $=Promise.resolve();let I=false;let x=false;function R(n,a,o,i,l,d,h,m,p){function y(){postMessage(["library-loaded"]);P(l,d,m)}function b(){if(!k&&T&&w){v=false;Module.callMain();k=true;y();if(!l){D();q()}}}if(v){return Promise.resolve()}if(k){y();return Promise.resolve()}v=true;const S=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,1,253,15,253,98,11]));const{jsURI:_,wasmURI:M}=X(a,h,S);c=i;u=i?e:t;f=`${a}${r}/`;g=d;self.window=self.document=self;self.path=o;self.deviceModelName=p;Module={arguments:[n],canvas:s?new self.OffscreenCanvas(32,32):undefined,instantiateWasm:(e,t)=>{const r=self.wasmJSVersion??"undefined";if(r!=="5.9.3"){z("error",`The Scandit Data Capture library JS file found at ${_} seems invalid: `+`expected version doesn't match (received: ${r}, expected: ${"5.9.3"}). `+`Please ensure the correct Scandit Data Capture file (with correct version) is retrieved.`)}if(typeof self.WebAssembly.instantiateStreaming==="function"){oe(e,M,h,S,t)}else{se(e,M,h,S,t)}return{}},noInitialRun:true,preRun:[()=>ue().catch(e=>{z("debug","No IndexedDB support, some data will not be persisted:",e)}).then(()=>{T=true;b()})],onRuntimeInitialized:()=>{w=true;b()},print:(...e)=>{z("info",...e)},printErr:(...e)=>{z("error",...e)}};function F(){try{return importScripts(_)??Promise.resolve()}catch(e){return Promise.reject(e)}}return V(F,250,4e3,e=>{z("warn",e);z("warn",`Couldn't retrieve Scandit Data Capture library at ${_}, retrying...`)}).catch(e=>{z("error",e);z("error",`Couldn't retrieve Scandit Data Capture library at ${_}, did you configure the path for it correctly?`);return Promise.resolve(e)})}function P(e,t,r){function n(){postMessage(["context-created",{hiddenScanditLogoAllowed:Module._can_hide_logo()===1}])}if(C){return n()}if(e!=null){d=e}if(t!=null){g=t}if(r!=null){h=r}if(!k||d==null||g==null||!M&&!d||h==null){return}const a=lengthBytesUTF8(h)+1;const s=Module._malloc(a);stringToUTF8(h,s,a);const o=lengthBytesUTF8(u)+1;const i=Module._malloc(o);stringToUTF8(u,i,o);const l=lengthBytesUTF8(f)+1;const c=Module._malloc(l);stringToUTF8(f,c,l);Module._create_context(s,i,d,g,c,false);Module._free(s);Module._free(i);Module._free(c);C=true;ee();te();n()}function B(e,t,r){function n(){m=e;_=t;Y();D()}m=undefined;F=false;if(t&&r){ce(true,false,true).then(n).catch(n)}else{n()}}function A(e){p=e;Z();D()}function W(e){if(e.errorCode===260){let t;if(location.href?.indexOf("blob:null/")===0){t="localhost"}else{t=new URL(location.pathname!=null&&location.pathname!==""&&!location.pathname.startsWith("/")?location.pathname:location.origin).hostname}if(t[0].startsWith("[")&&t.endsWith("]")){t=t.slice(1,-1)}e.errorMessage=e.errorMessage.replace("domain name",`domain name (${t})`)}
// License Key related error codes from 6 to 25 and 260
if([6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,260].includes(e.errorCode)&&h!=null&&h.length>0){e.errorMessage+=` License Key: ${h.slice(0,15)}...`}}function j(e){if(e.highQualitySingleFrameMode){Y(true)}const t=re(e.data);if(e.highQualitySingleFrameMode){Y(false)}const r=JSON.parse(t);if(r.error!=null){W(r.error);postMessage(["work-error",{requestId:e.requestId,error:r.error},e.data],[e.data.buffer])}else{if(r.barcodeResult!=null&&r.textResult!=null){postMessage(["work-result",{requestId:e.requestId,result:{barcodes:r.barcodeResult,texts:r.textResult}},e.data],[e.data.buffer])}}}function D(){if(!k||n.length===0){return}if(!C){P()}if(!F){Y()}if(!U){Z()}if(!C||!F||!U){return}while(n.length!==0){if(n[0].highQualitySingleFrameMode&&y?.includes("code")===true&&!_){break}j(n.shift())}}function O(e){const t=ne(e.dataFormat,e.data,e.options);const r=JSON.parse(t);if(r.error!=null){W(r.error);postMessage(["parse-error",{requestId:e.requestId,error:r.error}])}else{if(r.result!=null){postMessage(["parse-result",{requestId:e.requestId,result:r.result}])}}}function q(){if(!k||a.length===0){return}if(!C){P();if(!C){return}}while(a.length!==0){O(a.shift())}}function N(e){M=true;n.push(e);D()}function E(e){M=true;a.push(e);q()}function L(){if(F){Module._scanner_session_clear()}}function J(e){function t(){postMessage(["create-blurry-table-result",e])}if(!k||!C){return}const r=lengthBytesUTF8(e)+1;const n=Module._malloc(r);stringToUTF8(e,n,r);Module._create_blurry_table(n);Module._free(n);$.then(t).catch(t)}function Q(e,t){b={cameraType:e,autofocus:t};ee()}function K(e){if(S!==e){S=e;te()}}function H(){L();n.length=0;a.length=0;m=undefined;p=undefined;M=false;F=false;U=false}function z(e,...t){t.forEach((e,r)=>{if(e instanceof Error){const n={name:e.name,message:e.message,stack:e.stack};t[r]=n}});postMessage(["log",{level:e,data:t}])}function V(e,t,r,n){return new Promise((a,s)=>{e().then(a).catch(o=>{const i=t*2;if(i>r){return s(o)}n(o);setTimeout(()=>{V(e,i,r,n).then(a).catch(s)},t)})})}function X(e,t,r){let n=false;if(/^https?:\/\/([^\/.]*\.)*cdn.jsdelivr.net\//.test(e)){e="https://cdn.jsdelivr.net/npm/scandit-sdk@5.9.3/build/";n=true}else if(/^https?:\/\/([^\/.]*\.)*unpkg.com\//.test(e)){e="https://unpkg.com/scandit-sdk@5.9.3/build/";n=true}let a="";if(t){a+="-ocr";if(r){a+="-simd"}}if(n){return{jsURI:`${e}scandit-engine-sdk${a}.min.js`,wasmURI:`${e}scandit-engine-sdk${a}.wasm`}}return{jsURI:`${e}scandit-engine-sdk${a}.min.js?v=5.9.3`,wasmURI:`${e}scandit-engine-sdk${a}.wasm?v=5.9.3`}}function G(e){return Array.from(new Uint8Array(e)).map(e=>{const t=e.toString(16);return t.length===1?`0${t}`:t}).join("")}function Y(e=false){if(!k||!C||!M||m==null){return}F=false;const t=JSON.parse(m);y=t.recognitionMode;t.textRecognitionSettings??=JSON.stringify({});const r=lengthBytesUTF8(m)+1;const n=Module._malloc(r);stringToUTF8(m,n,r);const a=lengthBytesUTF8(t.textRecognitionSettings)+1;const o=Module._malloc(a);stringToUTF8(t.textRecognitionSettings,o,a);const i=Module._scanner_settings_new_from_json(n,o,y?.includes("code")===true,y?.includes("text")===true,t.blurryRecognition===true&&_,t.matrixScanEnabled??false,e,t.gpuAcceleration===true&&s);Module._free(n);const l=UTF8ToString(i);if(l!==""){F=true;z("debug","External Scandit Data Capture scan settings:",JSON.parse(l))}}function Z(){if(!k||!C||!M||p==null){return}U=false;let e;if(p.format.valueOf()===1){e=3}else if(p.format.valueOf()===2){e=4}else{e=1}Module._scanner_image_settings_new(p.width,p.height,e);if(i!=null){Module._free(i)}l=p.width*p.height*e;i=Module._malloc(l);U=true}function ee(){if(!k||!C||b==null){return}Module._report_camera_properties(b.cameraType==="front",b.autofocus)}function te(){if(!k||!C||S==null){return}const e=lengthBytesUTF8(S)+1;const t=Module._malloc(e);stringToUTF8(S,t,e);Module._set_device_name(t);Module._free(t)}function re(e){if(e.byteLength!==l){return JSON.stringify({barcodeResult:[],textResult:[]})}Module.HEAPU8.set(e,i);return UTF8ToString(Module._scanner_scan(i))}function ne(e,t,r){const n=typeof t==="string"?lengthBytesUTF8(t)+1:t.byteLength;const a=Module._malloc(n);if(typeof t==="string"){stringToUTF8(t,a,n)}else{Module.HEAPU8.set(t,a)}const s=lengthBytesUTF8(r)+1;const o=Module._malloc(s);stringToUTF8(r,o,s);const i=Module._parser_parse_string(e.valueOf(),a,n-1,o);Module._free(a);Module._free(o);return UTF8ToString(i)}function ae(e,t,r,n){function a(n){if(typeof crypto?.subtle?.digest==="function"){crypto.subtle.digest("SHA-256",n).then(n=>{const a=G(n);let s="40e84fd0fce799334e8e70ee8adb1c7ecef93306071fd42bcb20034d54703211";if(t){s=r?"0497e539c177b04c8bcf96144b50d43e0aab60ac3d348df0c4392e5a935eb756":"25cb9569675714d461302099fe476d161a6152bb10b8dfe11564567f6fe4afbd"}if(a!==s){z("error",`The Scandit Data Capture library WASM file found at ${e} seems invalid: `+`expected file hash doesn't match (received: ${a}, `+`expected: ${s}). `+`Please ensure the correct Scandit Data Capture file (with correct version) is retrieved.`)}}).catch(()=>{})}else{z("warn","Insecure context (see https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts): "+`The hash of the Scandit Data Capture library WASM file found at ${e} could not be verified`)}}function s(){return new Promise((t,r)=>{fetch(e).then(e=>{if(e.ok){e.clone().arrayBuffer().then(r=>{if(n){t(e)}a(r)}).catch(e=>{if(n){r(e)}});if(!n){t(e)}}else{r(new Error("HTTP status code is not ok"))}}).catch(e=>{r(e)})})}return V(s,250,4e3,t=>{z("warn",t);z("warn",`Couldn't retrieve Scandit Data Capture library at ${e}, retrying...`)}).catch(t=>{z("error",t);z("error",`Couldn't retrieve/instantiate Scandit Data Capture library at ${e}, `+"did you configure the path for it correctly?");return Promise.reject(t)})}function se(e,t,r,n,a){ae(t,r,n,true).then(e=>e.arrayBuffer()).then(r=>self.WebAssembly.instantiate(r,e).then(e=>{a(e.instance)}).catch(e=>{z("error",e);z("error",`Couldn't instantiate Scandit Data Capture library at ${t}, `+"did you configure the path for it correctly?")})).catch(()=>{})}function oe(e,t,r,n,a){ae(t,r,n,false).then(s=>{self.WebAssembly.instantiateStreaming(s,e).then(e=>{a(e.instance)}).catch(s=>{z("warn",s);z("warn","WebAssembly streaming compile failed. "+"Falling back to ArrayBuffer instantiation (this will make things slower)");se(e,t,r,n,a)})}).catch(()=>{})}function ie(){const r="FILE_DATA";let n;let a;let s;function o(){a?.result?.close();s?.result?.close();n(0)}function i(){try{const i=[];const l=a.result.transaction(r,"readonly");l.onerror=o;const c=l.objectStore(r).openCursor();c.onsuccess=()=>{const l=c.result;if(l==null){try{let e=0;const t=s.result.transaction(r,"readwrite");const l=t.objectStore(r);t.onerror=o;t.oncomplete=()=>{a.result.close();s.result.close();return n(e)};for(const t of i){const r=l.count(t.primaryKey);r.onsuccess=()=>{if(r.result===0){++e;l.add(t.value,t.primaryKey)}}}}catch(e){o.call({error:e})}}else{i.push({value:l.value,primaryKey:l.primaryKey.toString().replace(`${e}/`,`${t}/`)});l.continue()}};c.onerror=o}catch(e){o.call({error:e})}}return new Promise(l=>{n=l;a=indexedDB.open(e);a.onupgradeneeded=()=>{try{a.result.createObjectStore(r)}catch(e){}};a.onsuccess=()=>{if(!Array.from(a.result.objectStoreNames).includes(r)){return l(0)}s=indexedDB.open(t);s.onupgradeneeded=()=>{try{s.result.createObjectStore(r)}catch(e){}};s.onsuccess=()=>{i()};s.onblocked=s.onerror=o};a.onblocked=a.onerror=o})}function le(e,t){if(o==null){return Promise.resolve()}I=true;return new Promise((r,n)=>{(!c&&e?ie():Promise.resolve(0)).then(a=>{if(!c&&e&&!t&&a===0){I=false;return r()}o(e,e=>{I=false;if(e!=null){return n(e)}r()})}).catch(n)})}function ce(e,t=false,r=false){if(!x||r){if(I){x=true;$=$.then(()=>{x=false;return le(e,t)})}else{$=le(e,t)}}return $}function ue(){o=FS.syncfs;FS.syncfs=(e,t)=>{const r=t;t=e=>{r(e)};ce(e).then(t).catch(t)};try{FS.mkdir(u)}catch(e){if(e.code!=="EEXIST"){o=undefined;return Promise.reject(e)}}FS.mount(IDBFS,{},u);return ce(true,true)}return{loadLibrary:R,setScanSettings:B,setImageSettings:A,workOnScanQueue:D,workOnParseQueue:q,addScanWorkUnit:N,addParseWorkUnit:E,clearSession:L,createBlurryTable:J,setCameraProperties:Q,setDeviceName:K,reset:H}}function edataCaptureWorkerFunction(){const e=dataCapture();onmessage=t=>{
// Creating context triggers license key verification and activation: delay until first frame processed
const r=t.data;switch(r.type){case"load-library":e.loadLibrary(r.deviceId,r.libraryLocation,r.path,r.preload,r.delayedRegistration,r.highEndBlurryRecognition,r.textRecognition,r.licenseKey,r.deviceModelName);break;case"scan-settings":e.setScanSettings(r.settings,r.blurryRecognitionAvailable,r.blurryRecognitionRequiresUpdate);break;case"image-settings":e.setImageSettings(r.imageSettings);break;case"scan-image":e.addScanWorkUnit({requestId:r.requestId,data:r.data,highQualitySingleFrameMode:r.highQualitySingleFrameMode});break;case"parse":e.addParseWorkUnit({requestId:r.requestId,dataFormat:r.dataFormat,data:r.data,options:r.options});break;case"clear-session":e.clearSession();break;case"create-blurry-table":e.createBlurryTable(r.symbology);break;case"camera-properties":e.setCameraProperties(r.cameraType,r.autofocus);break;case"device-name":e.setDeviceName(r.deviceName);break;case"reset":e.reset();break;default:break}}}export const dataCaptureWorkerBlob=new Blob([`var Module;${dataCapture.toString()}(${edataCaptureWorkerFunction.toString()})()`],{type:"text/javascript"});